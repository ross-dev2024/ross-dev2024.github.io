---
title: Elasticsearchとは
createTime: 2021/06/03 05:44:32
permalink: /es/concept1/
author: ross.dev
---
## Elasticsearch とは

複数のファイルから特定の文字列を分散検索するソフトウェアです。
ES は主に次の問題を解決します。

1) 関連データを取得する;
2) 統計結果を返す;
3) 高速である。

::: tip 全文検索

全文検索とは、複数のファイルから特定の文字列を検索することです。

:::

## Thinking

### 大規模なデータをどのように取得するか？

たとえば、システムのデータ量が 10 億や 100 億に達した場合、システム アーキテクチャを設計する際には、通常次のような観点から問題を検討します。

1) どのデータベースを使用するのが最適か? ( MySQL、 sybase 、 Oracle 、 Dameng 、 Shentong 、MongoDB、 Hbase...)
2) 単一障害点を解決する方法 (lvs、F5、A10、Zookeeper、MQ)
3) データのセキュリティを確保する方法 (ホットスタンバイ) 、コールド スタンバイ、さまざまな場所でのマルチ アクティビティ)
4) 取得問題の解決方法 (データベース プロキシ ミドルウェア: mysql-proxy、Cobar、MaxScale など)
5) 統計分析の問題の解決方法 (オフライン、ほぼリアル) -時間）

### 従来型データベースのソリューション

リレーショナル データの場合、クエリ ボトルネックと書き込みボトルネックを解決するために、通常、次のアーキテクチャまたは同様のアーキテクチャを使用します: 解決策のポイント:

1) マスター/スレーブ バックアップを通じてデータ セキュリティの問題を解決する;
2) データベース エージェント ミドルウェアのハートビート モニタリングを通じて単一障害点を解決する
3) プロキシミドルウェアを介してクエリ文を各スレーブノードに配信し、結果を集計します。

![Algolia搜索](/images/backend/21.Elasticsearch/43583fb6.png)

### 非リレーショナルデータベース向けソリューション

Nosql データベースの場合、mongodb を例に挙げると、
他の原則も同様です: 解決策のポイント:

1) コピー バックアップを通じてデータ セキュリティを確保する;
2) ノード選択メカニズムを通じて単一点の問題を解決する;
3) 最初に構成ライブラリからシャーディング情報を取得する;その後、リクエストは各ノードに分散され、最後にルーティング ノードが結果をマージして要約します。

[//]: # (   ![Algolia搜索]&#40;/images/03.BackEnd/01.Elasticsearch/90fa5427.png&#41;)

## Elasticsearch Structure and Concepts


![](/images/backend/21.Elasticsearch/a164ce42.png)

![](/images/backend/21.Elasticsearch/7bbcf3ea.png)


- Cluster is a collection of one or more nodes.
- Node is a single server instance that runs Elasticsearch. While communicating with the cluster, it:
  Stores and indexes your data
  Provides search.
- Index is used to store the documents in dedicated data structures corresponding to the data type of fields (akin to a SQL database). Each index has one or more shards and replicas.
- Type is a collection of documents, which have something in common (akin to a SQL table).
- Shard is an Apache Lucene index. It's used to split indices and keep large amounts of data manageable.
- Replica is a fail-safe mechanism and basically a copy of your index's shard.
  Document is a basic unit of information that can be indexed (akin to a SQL row). It's expressed in JSON, which is a ubiquitous internet data interchange format.
  Field is the smallest individual unit of data in Elasticsearch (akin to a SQL column).


| Relational Database | Elasticsearch |
| ------------------- | ------------- |
| Cluster             | Cluster       |
| RDBMS Instance      | Node          |
| Table               | Index         |
| Row                 | Document      |
| Column              | Field         |



###  shard

[//]: # (![]&#40;../../.vuepress/public/images/03.BackEnd/21.Elasticsearch/40f086a6.png&#41;)


- Distributing Documents across Shards (Routing)
![](/images/backend/21.Elasticsearch/eba50084.png)


###  Replication
- to provide high availability in case nodes or shards fail. 
-   increased performance for search queries.
![](/images/backend/21.Elasticsearch/90ca6d5a.png)
  - operations that affect the index — such as adding, updating, or removing documents — are sent to the primary shard. 
  - When the operation completes, the operation will be forwarded to each of the replica shards in the replica group. If the shard has multiple replicas, the operation will be performed in parallel on each of the replicas. 
  - When the operation has completed successfully on every replica and responded to the primary shard, the primary shard will respond to the client that the operation has completed successfully. 

[//]: # (![]&#40;/images/backend/21.Elasticsearch/02.store_images/vuex-store.png&#41;)



[//]: # (![]&#40;../../.vuepress/public/images/03.BackEnd/21.Elasticsearch/9195d7bd.png&#41;)

## Reference

* [Elasticsearch学习，请先看这一篇！](https://cloud.tencent.com/developer/article/1066239?areaId=106001)
* [https://testdriven.io/blog/django-drf-elasticsearch/](https://testdriven.io/blog/django-drf-elasticsearch/)
* [Understanding Replication in Elasticsearch](https://codingexplained.com/coding/elasticsearch/understanding-sharding-in-elasticsearch)
* [Elasticsearch運用ノウハウ](https://engineering.mercari.com/blog/entry/20220311-97aec2a2f8/)

