---
title: analyzer
date: 2020-05-11 13:59:38
permalink: /es/concept3/
#article: false
#sidebar: false
---


## Analyzer

全文検索を行うために文章を単語の単位に分割する処理を、アナライザーと呼ぶ。
Analyzer とは、テキストを分析 (転置インデックスを作成) するルールです。


| **Analyzer の要素**                                                               | **説明**                                            |
|--------------------------------------------------------------------------------|---------------------------------------------------|
| [Char Filter](https://hogetech.info/oss/elasticsearch/analyzer#char_filter)    | **ドキュメントを前処理 (加工、フィルタリング)**                       |
| [Tokenizer Filter](https://hogetech.info/oss/elasticsearch/analyzer#tokenizer) | **ドキュメントをトークン（単語）に分割**                            |
| [Token filter](https://hogetech.info/oss/elasticsearch/analyzer#token_filter)  | **トークン (単語) のフィルタリング**不要なトークン(通常は単語) をフィルタリングします。 |                                                 |

- before
```
人が恋に落ちるのは万有引力のせいではない。Albert Einstein（アルベルト・アインシュタイン）1879年 - 1955年
```

- after
```
人 恋 落ちる 万有引力 せい albert einstein アルベルト アインシュタイン 1879 年 1955 年
```
### 簡単例
![](/images/backend/21.Elasticsearch/38674b49.png)


### 詳細例
![](/images/backend/21.Elasticsearch/2112fce4.png)


#### Char Filter
入力されたテキストの前処理をするフィルタ機能です。インプットもアウトプットもテキストです。
ビルトインは3種類あります。
オプションなので、必要がなければ設定しなくてもかまいません。

>Tokenizer の前処理をする。例) HTMLをブラウザから見た文字列にする

- HTML Strip Character Filter
HTMLフォーマットを除去。見やすくなりました。
ここは<b>太字</b>です。 -> ここは太字です。

- Mapping Character Filter
特定文字をルールに基づいて変換。 絵文字とかの変換に使えそうです。
:) -> _happy_

- Pattern Replace Character Filter
定義されたルールに基づいて変換。 フォーマットの統一にいいですね。
2019/01/01 -> 2019-01-01

#### Tokenizer
テキストの分割処理を行い、トークン（単語）の列を生成します。インプットはテキストでアウトプットは単語です。
ビルトインは多くありますが、大きくカテゴリ分けして3種類あります。
ひとつのAnalyzerに一つ設定をしてください。

- 単語分割系
テキストを単語に分割。
Big Dog! -> BigDog
- N-gram系
連続したn個の文字で分割。こちらは2-gramです。
Big Dog! -> Biiggddoog

#### Token Filter
分割したトークンに対して、トークン単位で変換処理を行うもの。インプットもアウトプットも単語です。
ビルトインは多くありますが、代表的なもの4つ紹介します。
オプションなので、必要がなければ設定しなくてもかまいません。

- Lowercase Token Filter
全て小文字にする。
BigDog -> bigdog
- Stop Token Filter
ストップワードの除去。英語だと「the」「a」「for」などが挙げられます。
thisisapen -> pen
-  Stemmer Token Filter
ステミング（語幹処理）を行う。これは英語用ですが、別途プラグインで日本語に対応したものもあります。
making, maked -> make
- Synonym Token Filter
類義語を正規化して1つの単語にします。これは各自での定義する必要があります。
どのワードできても、同じ単語で扱いたい時に便利ですね。
ipod, i-pod, i pod => ipod
卵, 玉子, たまご

![](/images/backend/21.Elasticsearch/91a4ab12.png)

- Lowercase Token Filter


## Reference

- [Elasticsearch 入門３】Analyzer の設定と日本語の全部検索](https://www.yuque.com/u2308208/zqm6t6/gb1ylvggeefavcrx#R7JSt:~:text=%E3%80%90Elasticsearch%20%E5%85%A5%E9%96%80%EF%BC%93%E3%80%91Analyzer%20%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%A8%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%81%AE%E5%85%A8%E9%83%A8%E6%A4%9C%E7%B4%A2)
- [【Elasticsearch】Analyzerの基本的なこと](https://qiita.com/boutan/items/4a4341ad7fcd11205b94#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB)
- [analyzerを使う前に把握しておきたい内容まとめ](https://qiita.com/C_HERO/items/094af261db4725b4baa9#1-analyzer%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B3%E3%81%A4%E3%81%AE%E8%A6%81%E7%B4%A0)
- [elasticsearch-in-action](https://livebook.manning.com/book/elasticsearch-in-action/chapter-5/15)